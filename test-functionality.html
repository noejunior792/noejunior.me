<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Funcionalidades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-200">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Teste de Funcionalidades</h1>
        
        <!-- Theme Toggle Test -->
        <section class="mb-8 p-6 bg-gray-100 dark:bg-gray-800 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">Teste do Theme Toggle</h2>
            <button
                id="theme-toggle"
                class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200"
                aria-label="Toggle theme"
            >
                <span id="theme-icon">üåô</span> Toggle Theme
            </button>
            <p class="mt-2 text-sm">Status: <span id="theme-status">Carregando...</span></p>
        </section>

        <!-- Contact Form Test -->
        <section class="mb-8 p-6 bg-gray-100 dark:bg-gray-800 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">Teste do Formul√°rio de Contato</h2>
            
            <div class="mb-4">
                <button 
                    id="toggle-contact-form" 
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300"
                >
                    Contactar
                </button>
                <p class="mt-2 text-sm">Status: <span id="contact-status">Fechado</span></p>
            </div>

            <div id="contact-form-wrapper" class="hidden">
                <div class="p-4 bg-white dark:bg-gray-800 rounded-2xl shadow-xl transition-all duration-300 max-w-sm">
                    <h3 class="text-xl font-bold text-center text-gray-800 dark:text-white mb-3">Deixe um recadinho ‚ù§Ô∏è</h3>
                    <form id="anonymous-message-form" class="space-y-3">
                        <textarea 
                            id="message-textarea"
                            class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-4 focus:ring-pink-300 dark:focus:ring-pink-500 transition-all duration-300 text-sm resize-none" 
                            rows="4" 
                            placeholder="Sinta-se √† vontade para escrever o que quiser..."
                            maxlength="500"
                            required
                        ></textarea>
                        <div class="text-xs text-gray-500 dark:text-gray-400 text-right">
                            <span id="char-count">0</span>/500
                        </div>
                        <button 
                            id="submit-button"
                            type="submit" 
                            class="w-full px-4 py-2 font-bold text-gray-800 bg-gray-200 rounded-xl shadow-md hover:bg-gray-300 dark:text-gray-700 dark:hover:bg-gray-600 transition-all duration-300 flex items-center justify-center gap-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <span>Enviar com carinho</span>
                            <span>‚ù§Ô∏è</span>
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Test Results -->
        <section class="p-6 bg-gray-100 dark:bg-gray-800 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">Resultados dos Testes</h2>
            <div id="test-results" class="space-y-2">
                <div class="text-sm">Inicializando testes...</div>
            </div>
        </section>
    </div>

    <script>
        // Simple store implementation for testing
        class SimpleStore {
            constructor(initialValue) {
                this.value = initialValue;
                this.subscribers = [];
            }

            get() {
                return this.value;
            }

            set(newValue) {
                this.value = newValue;
                this.subscribers.forEach(callback => callback(newValue));
            }

            subscribe(callback) {
                this.subscribers.push(callback);
                return () => {
                    this.subscribers = this.subscribers.filter(cb => cb !== callback);
                };
            }
        }

        // Initialize stores
        const theme = new SimpleStore('light');
        const isContactFormOpen = new SimpleStore(false);

        // Test results tracker
        const testResults = [];

        function addTestResult(test, passed, message) {
            testResults.push({ test, passed, message });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = testResults.map(result => 
                `<div class="flex items-center gap-2">
                    <span class="${result.passed ? 'text-green-500' : 'text-red-500'}">${result.passed ? '‚úÖ' : '‚ùå'}</span>
                    <span class="font-medium">${result.test}:</span>
                    <span>${result.message}</span>
                </div>`
            ).join('');
        }

        // Theme functionality
        function initTheme() {
            const toggleButton = document.getElementById('theme-toggle');
            const themeStatus = document.getElementById('theme-status');
            const themeIcon = document.getElementById('theme-icon');

            // Initialize from localStorage
            const storedTheme = localStorage.getItem('theme');
            const initialTheme = storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            
            theme.set(initialTheme);

            function applyTheme(currentTheme) {
                if (currentTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeIcon.textContent = '‚òÄÔ∏è';
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIcon.textContent = 'üåô';
                }
                themeStatus.textContent = currentTheme;
                localStorage.setItem('theme', currentTheme);
            }

            applyTheme(initialTheme);
            theme.subscribe(applyTheme);

            toggleButton.addEventListener('click', () => {
                const newTheme = theme.get() === 'dark' ? 'light' : 'dark';
                theme.set(newTheme);
                addTestResult('Theme Toggle', true, `Mudou para ${newTheme}`);
            });

            addTestResult('Theme Initialization', true, `Tema inicial: ${initialTheme}`);
        }

        // Contact form functionality
        function initContactForm() {
            const toggleButton = document.getElementById('toggle-contact-form');
            const formWrapper = document.getElementById('contact-form-wrapper');
            const contactStatus = document.getElementById('contact-status');
            const form = document.getElementById('anonymous-message-form');
            const messageTextarea = document.getElementById('message-textarea');
            const charCount = document.getElementById('char-count');
            const submitButton = document.getElementById('submit-button');

            function updateContactFormUI(isOpen) {
                if (isOpen) {
                    formWrapper.classList.remove('hidden');
                    toggleButton.textContent = 'Fechar';
                    toggleButton.classList.add('bg-red-500', 'hover:bg-red-600');
                    toggleButton.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                    contactStatus.textContent = 'Aberto';
                } else {
                    formWrapper.classList.add('hidden');
                    toggleButton.textContent = 'Contactar';
                    toggleButton.classList.add('bg-blue-500', 'hover:bg-blue-600');
                    toggleButton.classList.remove('bg-red-500', 'hover:bg-red-600');
                    contactStatus.textContent = 'Fechado';
                }
            }

            isContactFormOpen.subscribe(updateContactFormUI);

            toggleButton.addEventListener('click', () => {
                const newState = !isContactFormOpen.get();
                isContactFormOpen.set(newState);
                addTestResult('Contact Form Toggle', true, `Formul√°rio ${newState ? 'aberto' : 'fechado'}`);
            });

            // Character counter
            function updateCharCount() {
                const count = messageTextarea.value.length;
                charCount.textContent = count;
                
                if (count > 450) {
                    charCount.classList.add('text-red-500');
                } else {
                    charCount.classList.remove('text-red-500');
                }
            }

            messageTextarea.addEventListener('input', updateCharCount);

            // Form submission (test mode)
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const message = messageTextarea.value.trim();
                
                if (!message) {
                    addTestResult('Form Validation', true, 'Valida√ß√£o de campo vazio funcionou');
                    alert('Por favor, escreva uma mensagem antes de enviar.');
                    return;
                }

                if (message.length > 500) {
                    addTestResult('Form Validation', true, 'Valida√ß√£o de limite de caracteres funcionou');
                    alert('Mensagem muito longa. M√°ximo 500 caracteres.');
                    return;
                }

                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="animate-pulse">Enviando...</span>';

                // Simulate API call
                setTimeout(() => {
                    addTestResult('Form Submission', true, 'Simula√ß√£o de envio bem-sucedida');
                    alert('Mensagem enviada com sucesso! (modo teste)');
                    messageTextarea.value = '';
                    updateCharCount();
                    isContactFormOpen.set(false);
                    
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>Enviar com carinho</span><span>‚ù§Ô∏è</span>';
                }, 1000);
            });

            updateContactFormUI(false);
            addTestResult('Contact Form Initialization', true, 'Formul√°rio inicializado com sucesso');
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initContactForm();
            
            // Test localStorage functionality
            try {
                localStorage.setItem('test', 'value');
                localStorage.removeItem('test');
                addTestResult('localStorage', true, 'LocalStorage dispon√≠vel');
            } catch (e) {
                addTestResult('localStorage', false, 'LocalStorage n√£o dispon√≠vel');
            }

            // Test dark mode media query
            try {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                addTestResult('Media Query', true, `Sistema prefer√™ncia: ${mediaQuery.matches ? 'dark' : 'light'}`);
            } catch (e) {
                addTestResult('Media Query', false, 'Media query n√£o suportada');
            }

            addTestResult('DOM Ready', true, 'P√°gina carregada com sucesso');
        });
    </script>
</body>
</html>